{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Climate Agency ‚Äî Live Weather Dashboard</title>
  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- Lottie -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

  <!-- Local CSS -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="dark-theme">

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-dark glass-nav px-3 py-2 fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <span class="brand-icon">üå¶Ô∏è</span>
        <span class="brand-text">Climate Agency</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-3">
          <li class="nav-item"><a class="nav-link active" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#" id="openMapBtn">Map</a></li>
          <li class="nav-item"><a class="nav-link" href="#newsSection">News</a></li>
          <li class="nav-item"><a class="nav-link" href="#videoSection">Video</a></li>
        </ul>

        <form id="searchForm" class="d-flex align-items-center me-3" onsubmit="return false;">
          <input id="searchCity" class="form-control search-input me-2" type="search" placeholder="Search city (e.g. Karachi)" />
          <button id="searchBtn" class="btn btn-outline-light">Search</button>
        </form>

        <div class="d-flex align-items-center gap-2">
          <div class="dropdown">
            <button class="btn btn-sm btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">Account</button>
            <ul class="dropdown-menu dropdown-menu-end">
              <li><a class="dropdown-item" href="{% url 'register' %}">Register</a></li>
              <li><a class="dropdown-item" href="{% url 'login' %}">Login</a></li>
              <li><a class="dropdown-item" href="#">Forgot Password</a></li>
            </ul>
          </div>

          <button id="themeToggle" class="btn btn-sm btn-theme" title="Toggle theme">
            <i id="themeIcon" class="fa-solid fa-moon"></i>
          </button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <main class="container pt-5 mt-4">
    <section class="hero glass-card p-4 shadow-sm">
      <div class="row align-items-center">
        <div class="col-md-7">
          <h2 id="heroTitle" class="fw-bold mb-1 silver">--</h2>
          <div class="d-flex align-items-end gap-3">
            <div>
              <div id="tempBig" class="display-1 fw-bold tempGradient">--¬∞C</div>
            </div>
            <div>
              <p id="conditionText" class="mb-1 silver-80">--</p>
              <div id="dateTime" class="small text-muted">--</div>
              <div class="small mt-2 silver-80" id="extraLine"></div>
            </div>
          </div>
        </div>

        <div class="col-md-5 text-center">
          <div id="lottieHolder" style="width:220px;height:220px;margin:auto;"></div>
        </div>
      </div>
    </section>

    <!-- Hourly -->
    <section class="mt-4">
      <h5 class="text-light">Hourly Forecast</h5>
      <div id="hourlyContainer" class="hourly-scroll mt-2"></div>
    </section>

    <!-- 15-day carousel -->
    <section class="mt-4">
      <h5 class="text-light">15-Day Forecast</h5>
      <div id="forecastCarousel" class="carousel slide mt-3" data-bs-ride="carousel">
        <div class="carousel-inner" id="forecast"></div>
        <button class="carousel-control-prev" type="button" data-bs-target="#forecastCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#forecastCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon"></span>
        </button>
      </div>
    </section>

    <!-- News (optional) -->
    <section id="newsSection" class="mt-4">
      <h5 class="text-light">Latest Climate News</h5>
      <div id="newsList" class="list-group list-group-flush mt-2"></div>
    </section>

    <!-- Video / Map -->
    <section id="videoSection" class="mt-4">
      <h5 class="text-light">Weather Video / Map</h5>
      <div class="row g-3">
        <div class="col-md-8">
          <div class="glass-card p-3">
            <div class="small text-muted mb-2">Live video / article (placeholder)</div>
            <iframe id="videoFrame" src="" style="width:100%;height:300px;border-radius:12px;border:none;"></iframe>
          </div>
        </div>
        <div class="col-md-4">
          <div class="glass-card p-3">
            <div class="d-flex justify-content-between align-items-center">
              <strong>Quick Tools</strong>
              <div>
                <button id="openMapBtnSmall" class="btn btn-sm btn-outline-light">Open Map</button>
              </div>
            </div>
            <div class="mt-3 small text-muted">OpenWeather map opens in a new tab.</div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="mt-5 py-4 text-center">
    <div class="container">
      <div class="small silver-80">¬© 2025 Climate Agency ‚Äî Live Weather Dashboard</div>
      <div class="mt-2">
        <a class="social" href="#" aria-label="twitter"><i class="fab fa-twitter"></i></a>
        <a class="social" href="#" aria-label="linkedin"><i class="fab fa-linkedin"></i></a>
        <a class="social" href="#" aria-label="github"><i class="fab fa-github"></i></a>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- App JS -->
  <script src="{% static 'js/script.js' %}"></script>

</body>
</html>
======================================================
import requests
import django.shortcuts 
import render
import datetime 
import django.http 
import JsonResponse
from dotenv import load_dotenv
load_dotenv()
import os

from pathlib import Path
DEBUG = os.getenv("DEBUG", "True") == "True"

SECRET_KEY = os.getenv("", "fallback_secret_key")

DATABASES = {
    'default': {
        'ENGINE': 'djongo',  # for MongoDB
        'NAME': os.getenv("climate_agency_db", "climate_data"),
        'CLIENT': {
            'host': os.getenv("climate_agency_db", "localhost"),
            'port': int(os.getenv("DB_PORT", "27017")),
        }
    }
}


API_KEY = "bedfaf1716027c9c280859ad56670795"
BASE_URL = "https://api.openweathermap.org/data/2.5/"


def index(request):
    weather_data = None
    if request.method == 'POST':
        city = request.POST.get('city')
        # api_key = 'bedfaf1716027c9c280859ad56670795'
        url = f'http://api.openweathermap.org/data/2.5/weather?q={city}&appid={api_key}&units=metric'
        response = requests.get(url)
        if response.status_code == 200:
            weather_data = response.json()
        else:
            weather_data = {'error': 'City not found.'}
    return render(request, 'index.html', {'climate_data': climate_data})





def home(request):
    city = request.GET.get("city", "Karachi")
    weather, hourly, daily = None, [], []
    error = None

    try:
        res = requests.get(f"{BASE_URL}weather?q={city}&units=metric&appid={API_KEY}").json()
        if res.get("cod") != 200:
            error = res.get("message", "City not found")
        else:
            weather = {
                "city": res["name"],
                "country": res["sys"]["country"],
                "temperature": round(res["main"]["temp"]),
                "description": res["weather"][0]["description"],
                "icon": res["weather"][0]["icon"],
                "humidity": res["main"]["humidity"],
                "wind": round(res["wind"]["speed"]),
                "sunrise": datetime.fromtimestamp(res["sys"]["sunrise"]).strftime("%H:%M"),
                "sunset": datetime.fromtimestamp(res["sys"]["sunset"]).strftime("%H:%M"),
                "condition": res["weather"][0]["main"],   # üëà ye background ke liye bhej rahe
            }

        # Forecast API (5 days / 3 hour)
        f_res = requests.get(f"{BASE_URL}forecast?q={city}&units=metric&appid={API_KEY}").json()
        if f_res.get("cod") == "200":
            # Hourly next 12 slots
            for item in f_res["list"][:12]:
                hourly.append({
                    "time": datetime.fromtimestamp(item["dt"]).strftime("%H:%M"),
                    "temp": round(item["main"]["temp"]),
                    "icon": item["weather"][0]["icon"],
                })
            # Daily forecast (1 per day, max 15 days)
            seen_days = set()
            for item in f_res["list"]:
                day = datetime.fromtimestamp(item["dt"]).strftime("%a %d")
                if day not in seen_days and len(daily) < 15:
                    seen_days.add(day)
                    daily.append({
                        "day": day,
                        "temp": round(item["main"]["temp"]),
                        "icon": item["weather"][0]["icon"],
                    })

    except Exception as e:
        error = str(e)

    return render(request, "index.html", {
        "climate_data": climate_data,
        "hourly": hourly,
        "daily": daily,
        "error": error,
    })
SECRET_KEY="django-insecure-q*biq3bty0o3d3@^tww*jgy_nnb*4zd8m51477%&cq1ms_cgmb"
DEBUG=True
ALLOWED_HOSTS="127.0.0.1,localhost"
DATABASE_NAME="climate_agency_db"
MONGO_URI="mongodb://localhost:27017/climate_agency_db"
DATABASE_USER="Syeda Nabela Shah"
DATABASE_PASSWORD="eshal@123"
MONGO_URI = mongodb+srv://SyedaNabelaShah:eshal@123@cluster0.mongodb.net/climate_db?retryWrites=true&w=majority


# DEBUG=True
# ALLOWED_HOSTS=127.0.0.1,localhost
# MONGO_DB_NAME=climate_agency_db
# MONGO_URI=mongodb://localhost:27017/climate_agency_db
# MONGO_DB_PORT=27017
# MONGO_DB_HOST=localhost


=====================================================================